{% extends '../layouts/auth.html' %}
{% block title %}{{ teacher.user.username }} - {{ teacher.grade }}{% endblock %}
{% block content %}
    <header class="w-6/12 mx-auto">
        <div class="p-2 rounded bg-blue-100 grid grid-cols-2 gap-3 ">
            <p>
                Nom d'utilisateur : <b>{{ teacher.user.username }}</b>
            </p>
            <p>
                Email : <b>{{ teacher.user.email }}</b>
            </p>
            <p>
                Nom : <b>{{ teacher.user.last_name }}</b>
            </p>
            <p>
                Prénom : <b>{{ teacher.user.first_name }}</b>
            </p>
            <p>
                Grade : <b>{{ teacher.grade }}</b>
            </p>
            <p>
                Crée le : <b>{{ teacher.user.date_joined }}</b>
            </p>
        </div>
    </header>
    <section class="my-8 w-6/12 mx-auto">
        <table class="border-collapse border border-gray-400 w-full">
            <thead>
                <tr>
                    <th class="border border-gray-400 px-4 py-2">ID</th>
                    <th class="border border-gray-400 px-4 py-2">Name</th>
                    <th class="border border-gray-400 px-4 py-2">Hourly volume</th>
                </tr>
            </thead>
            <tbody>
                {% for module in teacher_modules %}
                    <tr>
                        <td class="border border-gray-400 px-4 py-2">{{ module.id }}</td>
                        <td class="border border-gray-400 px-4 py-2">{{ module.name }}</td>
                        <td class="border border-gray-400 px-4 py-2">{{ module.volume }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="3" class="p-2 text-center">Aucun module à afficher</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
    <form method="get"
          action="{% url 'teachers_workspaces' %}"
          class="p-1 mt-2 mb-4 w-6/12 mx-auto">
        <label for="semester" class="block text-lg mb-2">Choisir un semestre:</label>
        <select name="semester"
                id="semester"
                class="border border-gray-400 px-4 py-2 mb-4 rounded w-72">
            {% for semester in semesters %}
                {% if selected_semester.id == semester.id %}
                    <option value="{{ semester.id }}" selected>{{ semester.name }} : {{ semester.start }} - {{ semester.end }}</option>
                {% else %}
                    <option value="{{ semester.id }}">{{ semester.name }} : {{ semester.start }} - {{ semester.end }}</option>
                {% endif %}
            {% endfor %}
        </select>
        <button type="submit" class="p-2 bg-gray-700 text-white rounded">Ok</button>
    </form>
    {% if selected_semester %}
        <section class="p-2 my-4 w-9/12 mx-auto">
            <div class="mb-4 flex flex-row align-center justify-end gap-2">
                <button class="bg-green-700 hover:bg-green-600 text-white py-2 px-4 rounded text-sm"
                        onclick="downloadPDF()">Download PDF</button>
            </div>
            <div id="edt">
                <div class="grid grid-cols-5 gap-2 bg-white p-2">
                    {% for day in days %}<div class="font-semibold text-center p-2">{{ day }}</div>{% endfor %}
                    <div class="flex flex-col gap-2">
                        {% for seance in dimanche %}
                            <div class="bg-blue-200 rounded p-1 flex flex-col gap-1">
                                <span>{{ seance.subject.name }} - {{ seance.salle.name }}</span>
                                <span>{{ seance.groupe.name }}</span>
                                <span>{{ seance.start_time }} - {{ seance.end_time }}</span>
                                <span>{{ seance.type }}</span>
                            </div>
                        {% empty %}
                            <div class="p-2 text-center">Empty</div>
                        {% endfor %}
                    </div>
                    <div class="flex flex-col gap-2">
                        {% for seance in lundi %}
                            <div class="bg-blue-200 rounded p-1 flex flex-col gap-1">
                                <span>{{ seance.subject.name }} - {{ seance.salle.name }}</span>
                                <span>{{ seance.groupe.name }}</span>
                                <span>{{ seance.start_time }} - {{ seance.end_time }}</span>
                                <span>{{ seance.type }}</span>
                            </div>
                        {% empty %}
                            <div class="p-2 text-center">Empty</div>
                        {% endfor %}
                    </div>
                    <div class="flex flex-col gap-2">
                        {% for seance in mardi %}
                            <div class="bg-blue-200 rounded p-1 flex flex-col gap-1">
                                <span>{{ seance.subject.name }} - {{ seance.salle.name }}</span>
                                <span>{{ seance.groupe.name }}</span>
                                <span>{{ seance.start_time }} - {{ seance.end_time }}</span>
                                <span>{{ seance.type }}</span>
                            </div>
                        {% empty %}
                            <div class="p-2 text-center">Empty</div>
                        {% endfor %}
                    </div>
                    <div class="flex flex-col gap-2">
                        {% for seance in mercredi %}
                            <div class="bg-blue-200 rounded p-1 flex flex-col gap-1">
                                <span>{{ seance.subject.name }} - {{ seance.salle.name }}</span>
                                <span>{{ seance.groupe.name }}</span>
                                <span>{{ seance.start_time }} - {{ seance.end_time }}</span>
                                <span>{{ seance.type }}</span>
                            </div>
                        {% empty %}
                            <div class="p-2 text-center">Empty</div>
                        {% endfor %}
                    </div>
                    <div class="flex flex-col gap-2">
                        {% for seance in jeudi %}
                            <div class="bg-blue-200 rounded p-1 flex flex-col gap-1">
                                <span>{{ seance.subject.name }} - {{ seance.salle.name }}</span>
                                <span>{{ seance.groupe.name }}</span>
                                <span>{{ seance.start_time }} - {{ seance.end_time }}</span>
                                <span>{{ seance.type }}</span>
                            </div>
                        {% empty %}
                            <div class="p-2 text-center">Empty</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>
    {% endif %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
    <script>
        function downloadPDF() {
            const doc = new jspdf.jsPDF();
            const element = document.getElementById('edt');
            //element.style.width = "100%";
            //element.style.height = "100%";
            html2canvas(element).then((canvas) => {
                const imgData = canvas.toDataURL('image/jpeg');

                // Calculate the desired dimensions for the image in the PDF
                const pdfWidth = doc.internal.pageSize.getWidth() - 30; // Adjust the margins if needed
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

                // Add the scaled image to the PDF
                doc.addImage(imgData, 'JPEG', 15, 15, pdfWidth, pdfHeight);
                doc.save('emploie_des_temps.pdf');
            });
        }
    </script>
{% endblock %}
